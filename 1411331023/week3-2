#include <stdio.h>
#include <stdlib.h>

// å®šç¾©å­¸ç”Ÿçµæ§‹é«”
typedef struct student {
    char name[20];
    int ID;
    int math, comput;
    double AVG;
} stu;

// è‡ªæˆ‘åƒè€ƒçµæ§‹
struct listNode {
    stu data; // æ¯å€‹ç¯€é»åŒ…å«å­¸ç”Ÿçµæ§‹
    struct listNode* nextPtr; // æŒ‡å‘ä¸‹ä¸€å€‹ç¯€é»çš„æŒ‡æ¨™
};

typedef struct listNode ListNode;
typedef ListNode* ListNodePtr;

// å‡½æ•¸åŸå‹
void insert(ListNodePtr* sPtr, stu value);
void printList(ListNodePtr currentPtr);
int isEmpty(ListNodePtr sPtr);
int deleteNode(ListNodePtr* sPtr, int ID);  // æ–°å¢åˆªé™¤å‡½å¼

int main(void) {
    ListNodePtr startPtr = NULL; // åˆå§‹åŒ–éˆè¡¨
    stu newStudent;

    // è¼¸å…¥å››ç­†å­¸ç”Ÿè³‡æ–™
    for (int i = 0; i < 4; i++) {
        printf("Enter name, ID, math score, computer score for student %d:\n", i + 1);
        scanf_s("%19s %d %d %d", newStudent.name, (unsigned)_countof(newStudent.name), &newStudent.ID, &newStudent.math, &newStudent.comput);
        newStudent.AVG = (newStudent.math + newStudent.comput) / 2.0; // è¨ˆç®—å¹³å‡åˆ†
        insert(&startPtr, newStudent); // æ’å…¥å­¸ç”Ÿ
    }

    // å°å‡ºéˆçµä¸²åˆ—çš„å…§å®¹
    printList(startPtr);

    // ğŸ”» é€ééµç›¤è¼¸å…¥è¦åˆªé™¤çš„ ID
    int targetID;
    printf("Enter student ID to delete: ");
    scanf_s("%d", &targetID);

    // å˜—è©¦åˆªé™¤ç¯€é»
    if (deleteNode(&startPtr, targetID)) {
        printf("Student with ID %d deleted.\n", targetID);
    } else {
        printf("Student with ID %d not found.\n", targetID);
    }

    // å†æ¬¡å°å‡º
    printList(startPtr);

    return 0;
}

// æ’å…¥å­¸ç”Ÿè³‡æ–™ï¼ˆæŒ‰ ID æ’åºï¼‰
void insert(ListNodePtr* sPtr, stu value) {
    ListNodePtr newPtr = (ListNodePtr)malloc(sizeof(ListNode)); // é¡¯å¼è½‰å‹
    if (newPtr != NULL) {
        newPtr->data = value;
        newPtr->nextPtr = NULL;

        ListNodePtr previousPtr = NULL;
        ListNodePtr currentPtr = *sPtr;

        // æ‰¾åˆ°é©ç•¶çš„ä½ç½®ï¼ˆæŒ‰ ID æ’åºï¼‰
        while (currentPtr != NULL && value.ID > currentPtr->data.ID) {
            previousPtr = currentPtr;
            currentPtr = currentPtr->nextPtr;
        }

        // æ’å…¥åˆ°é–‹é ­
        if (previousPtr == NULL) {
            newPtr->nextPtr = *sPtr;
            *sPtr = newPtr;
        } else {
            previousPtr->nextPtr = newPtr;
            newPtr->nextPtr = currentPtr;
        }
    } else {
        printf("Student %s not inserted. No memory available.\n", value.name);
    }
}

// åˆ¤æ–·åˆ—è¡¨æ˜¯å¦ç‚ºç©º
int isEmpty(ListNodePtr sPtr) {
    return sPtr == NULL;
}

// è¼¸å‡ºåˆ—è¡¨
void printList(ListNodePtr currentPtr) {
    if (isEmpty(currentPtr)) {
        puts("List is empty.\n");
    } else {
        puts("The student list:");

        while (currentPtr != NULL) {
            printf("Name: %s, ID: %d, Math: %d, Comput: %d, AVG: %.2f\n",
                currentPtr->data.name, currentPtr->data.ID,
                currentPtr->data.math, currentPtr->data.comput,
                currentPtr->data.AVG);
            currentPtr = currentPtr->nextPtr;
        }

        puts("");
    }
}

// ğŸ”» æ ¹æ“š ID åˆªé™¤ç¯€é»
int deleteNode(ListNodePtr* sPtr, int ID) {
    ListNodePtr previousPtr = NULL;
    ListNodePtr currentPtr = *sPtr;

    // å°‹æ‰¾è¦åˆªé™¤çš„ç¯€é»
    while (currentPtr != NULL && currentPtr->data.ID != ID) {
        previousPtr = currentPtr;
        currentPtr = currentPtr->nextPtr;
    }

    // æ‰¾åˆ°è©²ç¯€é»
    if (currentPtr != NULL) {
        // è¦åˆªçš„æ˜¯é–‹é ­ç¯€é»
        if (previousPtr == NULL) {
            *sPtr = currentPtr->nextPtr;
        } else {
            previousPtr->nextPtr = currentPtr->nextPtr;
        }

        free(currentPtr);
        return 1; // åˆªé™¤æˆåŠŸ
    }

    return 0; // æ²’æ‰¾åˆ°
}
